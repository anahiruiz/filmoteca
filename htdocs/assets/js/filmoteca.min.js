/* globals $, configuration */


/**
 * frontend/exhibitions/index
 */
$(document).ready(function () {

    'use strict';

    var $exhibitionsIndex = $('.exhibitions.index');
    var moreSchedulesSelector = '.more-schedules';

    $(moreSchedulesSelector).collapse({
        toggle: false
    });

    $exhibitionsIndex.on('click', moreSchedulesSelector , function (event) {

        var $element = $(event.target);
        var $collapsible = $element.siblings('.collapse');
        var config = {
            url: $element.data('href'),
            accepts: 'text/html',
            dataType: 'html',
            data: {
                since: $element.data('since')
            }
        };

        if ($element.data('loaded')) {
            $collapsible.collapse('toggle');
            return;
        }

        $element.addClass('loading');

        $.ajax(config)
            .success(function (response) {
                $collapsible.html(response).collapse('show');

                $element.data('loaded', true);
            })
            .fail(function () {
                $collapsible.collapse('hide');
            })
            .always(function () {
                $element.removeClass('loading');
            });
    });
});
